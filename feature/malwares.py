import requests 
import json

from feature.func import getApiKey


class Malwares:
    def __init__(self):
        pass
    
    def start(self, url: str, return_dict, key: str) -> dict:
        params = {'api_key': getApiKey("malwares_api"), 'url': url}
        headers = {'Content-Type' : 'application/x-www-form-urlencoded'}
        response = requests.post('https://public.api.malwares.com/v3/url/info', data=params, headers=headers)

        # TODO
        # 결과에 virustotal 정보도 있음. 이에 대한 정보도 제공해야 할듯

        try:
            return_data = {
                "malicious": response.json()["smishing"]
            }
        except KeyError:
            return_data = {
                "malicious": 0,
                "message" : "현재 분석 중 입니다."
            }
        
        return_dict[key] = return_data