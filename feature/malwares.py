import requests 
import json

class Malwares:
    def __init__(self):
        pass
    
    def start(self, url: str) -> dict:
        params = {'api_key': self.getApiKey(), 'url': url}
        headers = {'Content-Type' : 'application/x-www-form-urlencoded'}
        response = requests.post('https://public.api.malwares.com/v3/url/info', data=params, headers=headers)
        
        # if json_response['smishing'] == 1:
        #     print("DANGER")
        # else:
        #     print("SAFE")

        # TODO
        # 결과에 virustotal 정보도 있음. 이에 대한 정보도 제공해야 할듯

        try:
            return {
                "malicious": response.json()["smishing"]
            }
        except KeyError:
            return {
                "malicious": 0,
                "message" : "현재 분석 중 입니다."
            }
            
    def getApiKey(self) -> str:
        f = open("./config/api.json")
        api_key = json.load(f)
        
        return api_key["malwares_api"]